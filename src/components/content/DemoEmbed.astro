---
interface Props {
  src: string;
  height?: number;
  fallbackImage?: string;
  title?: string;
  class?: string;
}

const {
  src,
  height = 400,
  fallbackImage,
  title = 'Live demo',
  class: className
} = Astro.props;
---

<figure class:list={["demo-embed", className]}>
  <div class="demo-frame" style={`height: ${height}px`}>
    <span class="corner corner--tl">┌</span>
    <span class="corner corner--tr">┐</span>
    <span class="corner corner--bl">└</span>
    <span class="corner corner--br">┘</span>

    <iframe
      src={src}
      title={title}
      loading="lazy"
      class="demo-iframe"
    ></iframe>

    {fallbackImage && (
      <noscript>
        <img src={fallbackImage} alt={title} class="demo-fallback" />
      </noscript>
    )}
  </div>

  <figcaption class="demo-caption">
    <span>{title}</span>
    <a href={src} target="_blank" rel="noopener noreferrer" class="demo-link">
      open in new tab ↗
    </a>
  </figcaption>
</figure>

<style>
  .demo-embed {
    margin: var(--space-4) 0;
  }

  .demo-frame {
    position: relative;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-light);
    overflow: hidden;
  }

  .corner {
    position: absolute;
    font-size: var(--text-sm);
    line-height: 1;
    color: var(--text-ghost);
    background: var(--bg-tertiary);
    padding: 0 3px;
    z-index: 1;
  }

  .corner--tl { top: -1px; left: -1px; }
  .corner--tr { top: -1px; right: -1px; }
  .corner--bl { bottom: -1px; left: -1px; }
  .corner--br { bottom: -1px; right: -1px; }

  .demo-iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  .demo-fallback {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .demo-caption {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: var(--space-1);
    font-size: var(--text-sm);
    color: var(--text-muted);
  }

  .demo-link {
    color: var(--rust-muted);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .demo-link:hover {
    color: var(--rust);
  }
</style>